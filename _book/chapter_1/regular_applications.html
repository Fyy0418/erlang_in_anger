<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <title>Regular Applications | Introduction</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.0.3">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    
    <link rel="next" href="../chapter_1/dependencies.html" />
    
    
    <link rel="prev" href="../chapter_1/library_applications.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../gitbook/style.css">


        
    <div class="book"  data-level="1.2.2" data-basepath=".." data-revision="1413945002350">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="chapter_1/README.html">
            
                
                    <a href="../chapter_1/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         Chapter 1 How to Dive into a Code Base
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1" data-path="chapter_1/11_raw_erlang.html">
            
                
                    <a href="../chapter_1/11_raw_erlang.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                         Raw Erlang
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.2" data-path="chapter_1/otp_applications.html">
            
                
                    <a href="../chapter_1/otp_applications.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                         OTP Applications
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.2.1" data-path="chapter_1/library_applications.html">
            
                
                    <a href="../chapter_1/library_applications.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.1.</b>
                        
                         Library Applications
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter active" data-level="1.2.2" data-path="chapter_1/regular_applications.html">
            
                
                    <a href="../chapter_1/regular_applications.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.2.</b>
                        
                         Regular Applications
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.2.3" data-path="chapter_1/dependencies.html">
            
                
                    <a href="../chapter_1/dependencies.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.3.</b>
                        
                         Dependencies
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="1.3" data-path="chapter_1/otp_realease.html">
            
                
                    <a href="../chapter_1/otp_realease.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                         OTP Releases
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.4" data-path="chapter_1/excerises.html">
            
                
                    <a href="../chapter_1/excerises.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                         Excerises
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Introduction</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_9">
                    
                        <h1 id="regular-applications">Regular Applications</h1>
<p>For a regular OTP application, there are two potential modules that act as the entry point:</p>
<p></p>
<font color="green" >
对于一个regular OTP application，有2个潜在的模块作为入口：
</font>
<p></p>
1. appname </br>
2. appname _app
<p></p>
The first file should be similar in use to what we had in a library application (an entry point), while the second one will implement the application behaviour, and will represent the top of the application’s process hierarchy. In some cases the first file will play both roles at once.
<p></p>
<font color="green" >
appname用法和library application中的相似，而appname_app文件会实现application 的具体行为(behaviour)，这代表着applicaiton进程中的最顶层，在某些情况下，appname文件同时担当这2个角色。
</font>
<p></p>
If you plan on simply adding the application as a dependency to your own app, then look inside appname for details and information. If you need to maintain and/or fix the application, go for appname _app instead.
<p></p>
<font color="green" >
如果你只是打算简单地将应用程序作为依赖项添加自已的app里面,你只需要看懂appname里面的信息和细节;
如果你需要操作或修复这个application，你就应该去看appname_app。
</font>
<p></p>
The application will start a top-level supervisor and return its pid. This top-level supervisor will then contain the specifications of all the child processes it will start on its own <sup>3</sup>.
The higher a process resides in the tree, the more likely it is to be vital to the survival of the application.
<p></p>
<font color="green" >
application 会启动最高层的监控进程(supervisor)并返回他的pid. 这个监控进程会含用自己启动的所有子进程的详细信息<sup>3</sup>。
进程所在树的位置越高，对application的生存影响越大。
</font>
<p></p>
You can also estimate how important a process is by the order it is started (all children in the supervision tree are started in order, depth-first). If a process is started later in the supervision tree, it probably depends on processes that were started earlier.
<p></p>
<font color="green" >
你也要通过进程的重要性来评估进程启动的顺序(所有的在监控进程下的子进程都会顺序启动)。如果你一个进程在监控树中晚一些启动，很有可能他的启动是依赖于早些启动的进程的。
</font>
<p></p>
Moreover, worker processes that depend on each other within the same application (say, a process that buffers socket communications and relays them to a finite-state machine in charge of understanding the protocol) are likely to be regrouped under the same supervisor and to fail together when something goes wrong. This is a deliberate choice, as it is usually simpler to start from a blank slate, restarting both processes, rather than trying to figure out how to recuperate when one or the other loses or corrupts its state.
<p></p>
<font color="green" >
此外，在同一个application里相互依赖的工作进程(例如：一个缓存socket通信信息并把他们交给一个负责解析协议的有效状态机的进程)会被分给同一个监控进程，这样可以其中一个出错后，2个进程同时失败掉。这是一个深思熟虑的选择，因为他通常简单得从一张白纸状态启动，重启2个进程比试图恢复其中的错误进程好用得多。
</font>
<p></p>
The supervisor restart strategy reflects the relationship between processes under a supervisor:<br>
• one_for_one and simple_one_for_one are used for processes that are not dependent upon each other directly, although their failures will collectively be counted towards total application shutdown <sup>4</sup>.<br>
• rest_for_one will be used to represent processes that depend on each other in a linear manner.<br>
• one_for_all is used for processes that entirely depend on each other.
This structure means it is easiest to navigate OTP applications in a top-down manner by exploring supervision subtrees.<br>
<p></p>
<font color="green" >
监控进程的重启策略由子进程间的相互关系决定：<br>
• one_for_one 和 simple_one_for_one <br>
用于：子进程间没有直接相互依赖关系，尽管他们失败会集中记录到application关闭<sup>4</sup>。
• rest_for_one 会用于进程间有线性关系(linear manner)的场合。<br>
• one_for_all 用于一个进程异常，其它全部也会影响的场合。<br>
上面这些结构意味着：通过监控树的方法从上而下地驾驭OTP application是一件非常容易的事。
</font>
<p></p>

<p>For each worker process supervised, the behaviour it implements will give a good clue about its purpose:<br>
• a gen_server holds resources and tends to follow client/server patterns (or more generally, request/response patterns)<br>
• a gen_fsm will deal with a sequence of events or inputs and react depending on them, as a Finite State Machine. It will often be used to implement protocols.<br>
• a gen_event will act as an event hub for callbacks, or as a way to deal with notifications of some sort.<br>
All of these modules will contain the same kind of structure: exported functions that represent the user-facing interface, exported functions for the callback module, and private functions, usually in that order.<br></p>
<p><font color="green" >
对于每一个工作进程都监控，它的behaviour会很好地禅述它真正的目的：<br>
• gen_server 保存资源(holds resources)，倾向于遵循客户/服务器模式(client/server patterns),或更确切地说是，请求/应答模式(request/response patterns).<br>
•  gen_fsm 会处理一系列的事件或输入，或输入带来的一系列反应，就像一个有限状态机(Finite State Machine).常用于实现协议(implement protocols).<br>
• gen_event 作为一个事件回调中心，或用来处理某些形式的通知。<br>
以上所有的模块都有着相同的结构：导出面向使用者的接口，导出回调接口，私有函数。通常在模块中的顺序也是如此。
</font></p>
<p><p></p>
Based on their supervision relationship and the typical role of each behaviour, looking at the interface to be used by other modules and the behaviours implemented should reveal a lot of information about the program you’re diving into.</p>
<p><p></p></p>
<p><font color="green" >
基于他们的监控关系和典型的haviour角色，其它模块调用这些接口就可以给你提供很多信息，让你来深入了解它们。</p>
<p><p></p>
[3] In some cases, the supervisor specifies no children: they will either be started dynamically by some function of the API or in a start phase of the application, or the supervisor is only there to allow OTP environment variables (in the env tuple of the app file) to be loaded.<br>
[4] Some developers will use one_for_one supervisors when rest_for_one is more appropriate. They
require strict ordering to boot correctly, but forget about said order when restarting or if a predecessor
dies.</p>
<p><p></p>
[注3]：在某些情况下，监控进程不会有这些详细信息，他们会被用API动态的创建出来;或者从OTP的环境变量中获得app file加载<br>
[注4]：有些开发者在使用one_for_one的策略，但是实际上rest_for_one更合适。他们在进程死亡或重启时都需要遵守一定严格顺序</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../chapter_1/library_applications.html" class="navigation navigation-prev " aria-label="Previous page: Library Applications"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../chapter_1/dependencies.html" class="navigation navigation-next " aria-label="Next page: Dependencies"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
